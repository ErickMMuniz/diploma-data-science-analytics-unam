"0","# PCA a 3 componentes sobre los datos escalados"
"0","pca3 <- prcomp(X_scaled, center = FALSE, scale. = FALSE)"
"0","pc_df <- as.data.frame(pca3$x[, 1:3])"
"0","names(pc_df) <- c(""PC1"", ""PC2"", ""PC3"")"
"0","pc_df$cluster <- factor(km2$cluster)"
"0",""
"0","# Etiquetas con varianza explicada para los ejes"
"0","var_exp <- (pca3$sdev^2) / sum(pca3$sdev^2)"
"0","xl <- paste0(""PC1 ("", round(100 * var_exp[1], 1), ""%)"")"
"0","yl <- paste0(""PC2 ("", round(100 * var_exp[2], 1), ""%)"")"
"0","zl <- paste0(""PC3 ("", round(100 * var_exp[3], 1), ""%)"")"
"0",""
"0","if (knitr::is_html_output()) {"
"0","  # --- Interactivo (HTML) ---"
"0","  # install.packages(""plotly"") si hace falta"
"0","  plot_ly("
"0","    pc_df,"
"0","    x = ~PC1, y = ~PC2, z = ~PC3,"
"0","    color = ~cluster, symbol = ~cluster,"
"0","    symbols = c(""circle"", ""triangle-up""),"
"0","    type = ""scatter3d"", mode = ""markers"","
"0","    marker = list(size = 3)"
"0","  ) %>%"
"0","    layout("
"0","      title = ""Clusters en 3D (PCA)"","
"0","      scene = list("
"0","        xaxis = list(title = xl),"
"0","        yaxis = list(title = yl),"
"0","        zaxis = list(title = zl)"
"0","      ),"
"0","      legend = list(title = list(text = ""Cluster""))"
"0","    )"
"0","} else {"
"0","  # --- Est√°tico (PDF) ---"
"0","  # install.packages(""scatterplot3d"") si hace falta"
"0","  library(scatterplot3d)"
"0","  cols <- c(""#E64B35"", ""#00A087"")  # colores distintos por cluster"
"0","  pchs <- c(16, 17)"
"0","  col_vec <- cols[as.integer(pc_df$cluster)]"
"0","  pch_vec <- pchs[as.integer(pc_df$cluster)]"
"0",""
"0","  scatterplot3d(pc_df$PC1, pc_df$PC2, pc_df$PC3,"
"0","                color = col_vec, pch = pch_vec,"
"0","                main = ""Clusters en 3D (PCA)"","
"0","                xlab = xl, ylab = yl, zlab = zl,"
"0","                grid = TRUE, box = FALSE)"
"0","  legend(""topright"", legend = levels(pc_df$cluster),"
"0","         col = cols, pch = pchs, bty = ""n"", cex = 0.9, title = ""Cluster"")"
"0","}"
